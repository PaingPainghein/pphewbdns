<!doctype html>
<html lang="my" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PVPN DNS CREATOR</title>
  <style>
    :root{
      --fg:#0b1220; --muted:#5b6b84; --line:#d8e3ee;
      --accent:#14b8a6; --accent-ink:#0ea5e9;
      --ok:#10b981; --ok-bright:#059669;
      --warn:#f59e0b; --err:#ef4444;
      --time:#8b5cf6; --loc:#06b6d4;
      --bg1:#eef2ff; --bg2:#e0fbff; --bg3:#fae8ff;
      --card:#ffffffc9; --card-tint:#f8fafc;
      --tri: linear-gradient(90deg, #14b8a6 0%, #06b6d4 50%, #6366f1 100%);
      --shadow-strong: 0 10px 18px rgba(11,18,32,.12);
      --shadow-soft:   0 5px 12px rgba(11,18,32,.08);
      --table-row:#fff;
      --grain:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'><filter id='f'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/><feColorMatrix type='saturate' values='0'/><feComponentTransfer><feFuncA type='linear' slope='0.035'/></feComponentTransfer></filter><rect width='100%' height='100%' filter='url(#f)'/></svg>");
    }
    [data-theme="dark"]{
      --fg:#e5eefc; --muted:#9fb1c9; --line:#223043;
      --accent:#5eead4; --accent-ink:#7dd3fc;
      --ok:#34d399; --ok-bright:#34d399;
      --time:#c4b5fd; --loc:#67e8f9;
      --bg1:#06131f; --bg2:#0a1c2c; --bg3:#0e1f3b;
      --card:#0f1a2ae6; --card-tint:#0b1422;
      --warn:#fbbf24; --err:#f87171;
      --shadow-strong: 0 10px 18px rgba(0,0,0,.45);
      --shadow-soft:   0 5px 12px rgba(0,0,0,.35);
      --table-row:#0c1423;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--fg);
      background:
        radial-gradient(1200px 700px at 15% 0%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1300px 800px at 90% 20%, var(--bg2) 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 110%, var(--bg3) 0%, transparent 50%),
        linear-gradient(160deg,#f8fafc 0%, #eff6ff 40%, #f0f9ff 100%);
      min-height:100vh; display:flex; align-items:start; justify-content:center; padding:10px;
      transition: background .3s ease, color .2s ease;
    }
    body::after{ content:""; position:fixed; inset:0; pointer-events:none; background-image:var(--grain); mix-blend-mode:multiply; opacity:.22; }
    [data-theme="dark"] body{
      background:
        radial-gradient(1400px 700px at 10% -10%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1400px 800px at 100% 30%, var(--bg2) 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 110%, var(--bg3) 0%, transparent 50%),
        linear-gradient(160deg,#05121a 0%, #0a1826 50%, #0c2036 100%);
    }

    .wrap{width:100%;max-width:680px;display:flex;flex-direction:column;gap:8px}
    .card{
      background: linear-gradient(180deg,var(--card) 0%,var(--card-tint) 100%);
      backdrop-filter:blur(10px);
      border:1px solid var(--line); border-radius:10px;
      box-shadow:var(--shadow-strong); padding:12px 10px;
    }

    h1{font-size:18px;margin-bottom:2px;display:flex;align-items:center;gap:6px}
    h2{font-size:15px;margin-bottom:6px}
    .byline{color:var(--accent-ink);font-weight:800;margin-bottom:6px;font-size:11px}

    .logo{width:20px;height:20px;border-radius:5px;overflow:hidden;display:inline-block}
    .logo img{width:100%;height:100%;object-fit:cover}

    form{display:grid;gap:8px}
    .row{display:grid;gap:4px;grid-template-columns:1fr;align-items:center}
    label{color:var(--muted);font-size:11px}
    input,select{
      width:100%;height:30px;padding:4px 8px;border:1px solid var(--line);border-radius:8px;
      font-size:13px;background:#fff;color:#0b1220;outline:none;transition:box-shadow .18s;
    }
    [data-theme="dark"] input,[data-theme="dark"] select{background:#0b1422;color:var(--fg);border-color:#1f2a38}
    input:focus,select:focus{border-color:transparent;box-shadow:0 0 0 2px rgba(20,184,166,.22), inset 0 0 0 1px var(--accent)}

    .btns{display:flex;gap:6px;margin-top:2px;flex-wrap:wrap}
    button{
      height:30px;border-radius:8px;font-weight:800;cursor:pointer;border:0;padding:0 10px;
      background-image:var(--tri); background-size:200% 100%; color:#fff; box-shadow:0 5px 10px rgba(11,18,32,.15);
      transition: background-position .2s ease, transform .12s ease; font-size:13px;
    }
    .btn-mini{height:26px;padding:0 8px;border-radius:7px;font-weight:700;font-size:11px}
    button:hover{transform:translateY(-1px); background-position:right center}

    #msg,#lookupMsg,#searchMsg,#loginMsg{
      margin-top:6px;padding:6px;border-radius:8px;border:1px solid var(--line);
      background:#f8fafc;min-height:26px;white-space:pre-wrap;color:#0b1220;font-size:12px;
    }
    [data-theme="dark"] #msg,[data-theme="dark"] #lookupMsg,[data-theme="dark"] #searchMsg,[data-theme="dark"] #loginMsg{ background:#0b1422; color:#e5eefc; border-color:#1f2a38; }
    .msg-ok{border-color:var(--ok)!important;background:#ecfdf5!important;color:var(--ok-bright)!important}
    .msg-warn{border-color:var(--warn)!important;background:#fffbeb!important}
    .msg-err{border-color:var(--err)!important;background:#fef2f2!important;color:#dc2626!important}
    [data-theme="dark"] .msg-ok{background:#062814!important}
    [data-theme="dark"] .msg-warn{background:#2a1f06!important}
    [data-theme="dark"] .msg-err{background:#2a0b0b!important}

    .switch{position:relative;display:inline-flex;align-items:center;gap:6px;cursor:pointer}
    .slider{ width:34px;height:18px;border-radius:999px;background:#e5e7eb;border:1px solid #d1d5db; transition:background .18s }
    [data-theme="dark"] .slider{ background:#0b1422; border-color:#1f2a38 }
    .slider::after{ content:"";position:absolute;top:2px;left:2px;width:14px;height:14px;background:#fff;border-radius:999px;transition:left .18s }
    .switch input:checked + .slider{ background:#fde68a; border-color:#f59e0b }
    .switch input:checked + .slider::after{left:18px}

    .pill{display:inline-block;padding:1px 6px;border-radius:999px;border:1px solid var(--line);font-size:10px;color:var(--fg);background:#fff;margin-left:6px}
    [data-theme="dark"] .pill{ background:#0b1422 }

    .table-wrap{overflow-x:auto}
    .table{width:100%;border-collapse:separate;border-spacing:0 4px;margin-top:4px;min-width:520px}
    .table thead th{text-align:left;font-size:10.5px;color:var(--muted);padding:0 6px}
    .table tbody tr{background:var(--table-row);border:1px solid var(--line);border-radius:8px;box-shadow:0 2px 6px rgba(11,18,32,.06);height:50px}
    .table td{padding:0 8px;font-size:12px;height:50px;vertical-align:middle}

    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
    .small{font-size:11px;color:var(--muted)}

    .status .items{display:grid;gap:6px;grid-template-columns:1fr}
    .pillstat{ border:1px solid var(--line); background:var(--table-row); border-radius:8px; padding:6px 8px; min-height:38px; display:flex; flex-direction:column; justify-content:center }
    .pillstat .k{font-size:10px;color:var(--muted)} .pillstat .v{font-weight:700}

    .theme-fab{
      position:fixed; right:12px; bottom:12px; z-index:9999;
      width:40px; height:40px; border-radius:999px; background-image:var(--tri); color:#fff; border:0; box-shadow:0 8px 16px rgba(59,130,246,.3); cursor:pointer;
    }
    .theme-fab svg{ width:18px; height:18px }
    .icon-sun{display:inline} .icon-moon{display:none}
    [data-theme="dark"] .icon-sun{display:none} [data-theme="dark"] .icon-moon{display:inline}

    .logout-fab{
      position:fixed; top:12px; right:12px; z-index:10001;
      width:40px; height:40px; border-radius:999px;
      background-image:var(--tri); color:#fff; border:0; box-shadow:0 8px 16px rgba(59,130,246,.30); cursor:pointer;
    }

    .gate{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:12px; z-index:10000;
      background:rgba(0,0,0,0.4); backdrop-filter:blur(8px);}
    .gate-card{ width:100%; max-width:340px; border:1px solid var(--line); border-radius:12px; padding:20px; background:var(--card); box-shadow:var(--shadow-strong); backdrop-filter:blur(10px) }
    .gate-title{ display:flex; align-items:center; gap:8px; font-weight:900; font-size:18px; margin-bottom:12px; justify-content:center }

    .hide{display:none!important}
  </style>
</head>
<body>

  <!-- Login Gate -->
  <div id="gate" class="gate">
    <div class="gate-card">
      <div class="gate-title">
        <span class="logo"><img alt="logo" src="https://play-lh.googleusercontent.com/tUt7o9JtLGGEzSo6kOXdJ8MpYAGhBUYEV2yoIGn4jtVA4WNQPfksB5ze8E29WpcrOdTgMVxuDygxFvtATiWS=w240-h480-rw"></span>
        <span>PVPN DNS Manager</span>
      </div>
      <form id="loginForm" autocomplete="off">
        <div class="row">
          <label for="loginUser">Username</label>
          <input id="loginUser" type="text" placeholder="dnsapi" required />
        </div>
        <div class="row">
          <label for="loginPass">Password</label>
          <input id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
        </div>
        <div class="btns"><button type="submit" style="width:100%">Login</button></div>
        <div id="loginMsg"></div>
      </form>
    </div>
  </div>

  <div class="wrap hide" id="appWrap">
    <!-- Status -->
    <div class="card status">
      <h2>Status</h2>
      <div class="items">
        <div class="pillstat"><div class="k">Server Time</div><div id="serverTime" class="v mono">‚Äî</div></div>
        <div class="pillstat"><div class="k">Your IP</div><div id="yourIp" class="v mono">‚Äî</div></div>
        <div class="pillstat"><div class="k">Location</div><div id="yourLoc" class="v">‚Äî</div></div>
      </div>
    </div>

    <!-- DNS Form -->
    <div class="card">
      <h1><span class="logo"><img alt="logo" src="https://play-lh.googleusercontent.com/tUt7o9JtLGGEzSo6kOXdJ8MpYAGhBUYEV2yoIGn4jtVA4WNQPfksB5ze8E29WpcrOdTgMVxuDygxFvtATiWS=w240-h480-rw"></span> PVPN DNS CREATOR</h1>
      <p class="byline">Power By : PPH DEX 2025</p>

      <form id="dnsForm">
        <div class="row">
          <label for="type">Type</label>
          <select id="type" required>
            <option value="A" selected>A</option><option value="AAAA">AAAA</option><option value="CNAME">CNAME</option>
            <option value="MX">MX</option><option value="TXT">TXT</option>
            <!-- ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äõ·ÄÑ·Ä∫ ·Ä°·ÄÅ·Äº·Ä¨·Ä∏ type ·Äê·ÄΩ·Ä± ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´ -->
          </select>
        </div>

        <div class="row">
          <label for="host">Host</label>
          <input id="host" type="text" placeholder="sub (or @)" required />
        </div>

        <div class="row">
          <label for="content">Content</label>
          <input id="content" type="text" placeholder="e.g. 1.2.3.4" required />
        </div>

        <div class="row" id="proxiedRow">
          <label for="proxied">Proxy through Cloudflare</label>
          <label class="switch">
            <input id="proxied" type="checkbox" checked />
            <span class="slider"></span>
          </label>
        </div>

        <div class="btns">
          <button type="submit">Add / Update</button>
          <button type="button" id="resetBtn">Reset</button>
        </div>
        <div id="msg"></div>
      </form>
    </div>

    <!-- Search Table -->
    <div class="card">
      <h2>DNS Records</h2>
      <div class="row">
        <label for="searchName">Search by name</label>
        <input id="searchName" placeholder="e.g. app" />
      </div>
      <div class="btns">
        <button type="button" id="searchBtn">Search</button>
        <button type="button" id="clearBtn">Clear</button>
      </div>
      <div id="searchMsg" class="small">Results from Cloudflare DNS</div>

      <div class="table-wrap">
        <table class="table">
          <thead><tr><th>Type</th><th>Name</th><th>Content</th><th>Proxy</th><th>Actions</th></tr></thead>
          <tbody id="recordsBody"></tbody>
        </table>
      </div>
    </div>

    <div class="footer" style="text-align:center;padding:10px;font-size:11px;color:var(--muted)">
      Developer : PPH DEX 2025
    </div>
  </div>

  <!-- Theme Toggle -->
  <button id="themeToggle" class="theme-fab hide" aria-label="Toggle theme">
    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
    <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
  </button>

  <!-- Logout -->
  <button id="logoutFab" class="logout-fab hide" aria-label="Logout">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 16l4-4m0 0l-4-4m4 4H7"/></svg>
  </button>

  <script>
    const API_BASE = "https://pphdevweb.painghein556.workers.dev";
    const ROOT_DOMAIN = "pphdev.shop"; // ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äõ·ÄÑ·Ä∫ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äï·Ä´

    const gate = document.getElementById("gate");
    const appWrap = document.getElementById("appWrap");
    const themeToggle = document.getElementById("themeToggle");
    const logoutFab = document.getElementById("logoutFab");
    const loginMsg = document.getElementById("loginMsg");

    // Auth token ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äñ·Ä≠·ÄØ·Ä∑
    function getAuthHeader() {
      const token = localStorage.getItem("dnsapi_auth");
      return token ? { "Authorization": `Basic ${token}` } : {};
    }

    // Auto login if saved
    (function checkSavedAuth() {
      const token = localStorage.getItem("dnsapi_auth");
      if (token) {
        fetch(API_BASE + "?per_page=1", { headers: getAuthHeader() })
          .then(r => r.ok ? showApp() : localStorage.removeItem("dnsapi_auth"))
          .catch(() => localStorage.removeItem("dnsapi_auth"));
      }
    })();

    // Login form
    document.getElementById("loginForm").addEventListener("submit", e => {
      e.preventDefault();
      const user = document.getElementById("loginUser").value.trim();
      const pass = document.getElementById("loginPass").value;
      const token = btoa(`${user}:${pass}`);
      localStorage.setItem("dnsapi_auth", token);

      fetch(API_BASE + "?per_page=1", { headers: { "Authorization": `Basic ${token}` } })
        .then(r => {
          if (r.ok) {
            loginMsg.textContent = "Login ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äï·Äº·ÄÆ ‚úÖ";
            loginMsg.className = "msg-ok";
            showApp();
            loadStatus();
            searchRecords();
          } else {
            throw new Error();
          }
        })
        .catch(() => {
          localStorage.removeItem("dnsapi_auth");
          loginMsg.textContent = "Username ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ Password ·Äô·Äô·Äæ·Äî·Ä∫·Äï·Ä´ ‚ùå";
          loginMsg.className = "msg-err";
        });
    });

    function showApp() {
      gate.classList.add("hide");
      appWrap.classList.remove("hide");
      themeToggle.classList.remove("hide");
      logoutFab.classList.remove("hide");
    }

    logoutFab.addEventListener("click", () => {
      localStorage.removeItem("dnsapi_auth");
      location.reload();
    });

    // Theme
    (function() {
      const saved = localStorage.getItem("theme");
      if (saved) document.documentElement.setAttribute("data-theme", saved);
    })();
    themeToggle.addEventListener("click", () => {
      const cur = document.documentElement.getAttribute("data-theme") || "light";
      const next = cur === "light" ? "dark" : "light";
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    });

    // Status (simple)
    async function loadStatus() {
      try {
        const r = await fetch("https://1.1.1.1/cdn-cgi/trace");
        const text = await r.text();
        const map = Object.fromEntries(text.trim().split("\n").map(l => l.split("=")));
        document.getElementById("yourIp").textContent = map.ip || "‚Äî";
        document.getElementById("yourLoc").textContent = map.loc || "‚Äî";
      } catch {}
    }

    // DNS Form
    document.getElementById("dnsForm").addEventListener("submit", async e => {
      e.preventDefault();
      const type = document.getElementById("type").value;
      let name = document.getElementById("host").value.trim();
      const content = document.getElementById("content").value.trim();
      const proxied = document.getElementById("proxied").checked;

      if (!name) name = "@";
      if (!name.includes(".")) name += "." + ROOT_DOMAIN;

      const payload = { type, name, content, proxied, ttl: 1 };

      const res = await fetch(API_BASE, {
        method: "POST",
        headers: { "Content-Type": "application/json", ...getAuthHeader() },
        body: JSON.stringify([payload])
      });

      const data = await res.json();
      const msg = document.getElementById("msg");
      if (data.success) {
        msg.textContent = "DNS record ·Äë·Ää·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ ‚úÖ";
        msg.className = "msg-ok";
        e.target.reset();
        searchRecords();
      } else {
        msg.textContent = "·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´ ‚ùå " + (data.errors?.[0]?.message || "");
        msg.className = "msg-err";
      }
    });

    // Search Records
    async function searchRecords() {
      const query = document.getElementById("searchName").value.trim();
      let url = API_BASE + "?per_page=100";
      if (query) url += `&name=${encodeURIComponent(query.includes(".") ? query : query + "." + ROOT_DOMAIN)}`;

      const res = await fetch(url, { headers: getAuthHeader() });
      const data = await res.json();
      const tbody = document.getElementById("recordsBody");
      tbody.innerHTML = "";

      if (data.result) {
        data.result.forEach(rec => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${rec.type}</td>
            <td class="mono">${rec.name}</td>
            <td class="mono">${rec.content}</td>
            <td>${rec.proxied ? "üü† Proxied" : "‚ö´ DNS Only"}</td>
            <td><button class="btn-mini" onclick="deleteRecord('${rec.id}')">Delete</button></td>
          `;
          tbody.appendChild(tr);
        });
      }
    }

    window.deleteRecord = async (id) => {
      if (!confirm("·Äí·ÄÆ record ·ÄÄ·Ä≠·ÄØ ·Äñ·Äª·ÄÄ·Ä∫·Äô·Äæ·Ä¨·Äú·Ä¨·Ä∏?")) return;
      const res = await fetch(API_BASE + "/" + id, {
        method: "DELETE",
        headers: getAuthHeader()
      });
      if (res.ok) {
        searchRecords();
      }
    };

    document.getElementById("searchBtn").addEventListener("click", searchRecords);
    document.getElementById("clearBtn").addEventListener("click", () => {
      document.getElementById("searchName").value = "";
      searchRecords();
    });

    // Initial load
    if (!gate.classList.contains("hide")) {
      searchRecords(); // ·Äô·Äõ·Äæ·Ä≠·Äõ·ÄÑ·Ä∫ ·Äô·ÄÅ·Ä±·Ä´·Ä∫·Äï·Ä´
    }
  </script>
</body>
</html>
