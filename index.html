<!doctype html>
<html lang="my" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PVPN DNS CREATOR</title>
  <style>
    :root{
      --fg:#0b1220; --muted:#5b6b84; --line:#d8e3ee;
      --accent:#14b8a6; --accent-ink:#0ea5e9;
      --ok:#10b981; --ok-bright:#059669;
      --warn:#f59e0b; --err:#ef4444;
      --time:#8b5cf6; --loc:#06b6d4;
      --bg1:#eef2ff; --bg2:#e0fbff; --bg3:#fae8ff;
      --card:#ffffffc9; --card-tint:#f8fafc;
      --tri: linear-gradient(90deg, #14b8a6 0%, #06b6d4 50%, #6366f1 100%);
      --shadow-strong: 0 10px 18px rgba(11,18,32,.12);
      --shadow-soft:   0 5px 12px rgba(11,18,32,.08);
      --card-bg-plain:#ffffffd9; --table-row:#fff;
      --grain:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'><filter id='f'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/><feColorMatrix type='saturate' values='0'/><feComponentTransfer><feFuncA type='linear' slope='0.035'/></feComponentTransfer></filter><rect width='100%' height='100%' filter='url(#f)'/></svg>");
    }
    [data-theme="dark"]{
      --fg:#e5eefc; --muted:#9fb1c9; --line:#223043;
      --accent:#5eead4; --accent-ink:#7dd3fc;
      --ok:#34d399; --ok-bright:#34d399;
      --time:#c4b5fd; --loc:#67e8f9;
      --bg1:#06131f; --bg2:#0a1c2c; --bg3:#0e1f3b;
      --card:#0f1a2ae6; --card-tint:#0b1422;
      --warn:#fbbf24; --err:#f87171;
      --shadow-strong: 0 10px 18px rgba(0,0,0,.45);
      --shadow-soft:   0 5px 12px rgba(0,0,0,.35);
      --card-bg-plain:#0f172acc; --table-row:#0c1423;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--fg);
      background:
        radial-gradient(1200px 700px at 15% 0%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1300px 800px at 90% 20%, var(--bg2) 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 110%, var(--bg3) 0%, transparent 50%),
        linear-gradient(160deg,#f8fafc 0%, #eff6ff 40%, #f0f9ff 100%);
      min-height:100vh; display:flex; align-items:start; justify-content:center; padding:10px;
      transition: background .3s ease, color .2s ease;
    }
    body::after{ content:""; position:fixed; inset:0; pointer-events:none; background-image:var(--grain); mix-blend-mode:multiply; opacity:.22; }
    [data-theme="dark"]{
      background:
        radial-gradient(1400px 700px at 10% -10%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1400px 800px at 100% 30%, var(--bg2) 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 110%, var(--bg3) 0%, transparent 50%),
        linear-gradient(160deg,#05121a 0%, #0a1826 50%, #0c2036 100%);
    }

    .wrap{width:100%;max-width:680px;display:flex;flex-direction:column;gap:8px}
    .card{
      background: linear-gradient(180deg,var(--card) 0%,var(--card-tint) 100%);
      backdrop-filter:blur(10px);
      border:1px solid var(--line); border-radius:10px;
      box-shadow:var(--shadow-strong); padding:12px 10px;
    }

    h1{font-size:18px;margin-bottom:2px;display:flex;align-items:center;gap:6px}
    h2{font-size:15px;margin-bottom:6px}
    .byline{color:var(--accent-ink);font-weight:800;margin-bottom:6px;font-size:11px}

    .logo{width:20px;height:20px;border-radius:5px;overflow:hidden;display:inline-block}
    .logo img{width:100%;height:100%;object-fit:cover;display:block}

    form{display:grid;gap:8px}
    .row{display:grid;gap:4px;grid-template-columns:1fr;align-items:center}
    label{color:var(--muted);font-size:11px}
    input,select{
      width:100%;height:30px;padding:4px 8px;border:1px solid var(--line);border-radius:8px;
      font-size:13px;background:#fff;color:#0b1220;outline:none;transition:box-shadow .18s;
    }
    [data-theme="dark"] input,[data-theme="dark"] select{background:#0b1422;color:var(--fg);border-color:#1f2a38}
    input:focus,select:focus{border-color:transparent;box-shadow:0 0 0 2px rgba(20,184,166,.22), inset 0 0 0 1px var(--accent)}

    .btns{display:flex;gap:6px;margin-top:2px;flex-wrap:wrap}
    button{
      height:30px;border-radius:8px;font-weight:800;cursor:pointer;border:0;padding:0 10px;
      background-image:var(--tri); background-size:200% 100%; color:#fff; box-shadow:0 5px 10px rgba(11,18,32,.15);
      transition: background-position .2s ease, transform .12s ease; font-size:13px;
    }
    .btn-mini{height:26px;padding:0 8px;border-radius:7px;font-weight:700;font-size:11px}
    button:hover{transform:translateY(-1px); background-position:right center}

    .copy-chip{ display:inline-flex; align-items:center; gap:4px; padding:1px 6px; border:1px solid var(--line); border-radius:999px; background:#fff; cursor:pointer; font-size:11px; line-height:1 }
    [data-theme="dark"] .copy-chip{ background:#0b1422; color:#fff }
    .copy-chip svg{ width:12px; height:12px }

    #msg,#lookupMsg,#searchMsg{
      margin-top:6px;padding:6px;border-radius:8px;border:1px solid var(--line);
      background:#f8fafc;min-height:26px;white-space:pre-wrap;color:#0b1220;font-size:12px;
    }
    [data-theme="dark"] #msg,[data-theme="dark"] #lookupMsg,[data-theme="dark"] #searchMsg{ background:#0b1422; color:#e5eefc; border-color:#1f2a38; }
    .footer{ text-align:center;margin-top:2px;font-size:11px;color:var(--fg);background:#fff;border:1px solid var(--line);border-radius:8px;padding:6px;box-shadow:var(--shadow-soft) }
    .msg-ok{border-color:var(--ok)!important;background:#ecfdf5!important}
    .msg-warn{border-color:var(--warn)!important;background:#fffbeb!important}
    .msg-err{border-color:var(--err)!important;background:#fef2f2!important}
    [data-theme="dark"] .msg-ok{background:#062814!important}
    [data-theme="dark"] .msg-warn{background:#2a1f06!important}
    [data-theme="dark"] .msg-err{background:#2a0b0b!important}

    .switch{position:relative;display:inline-flex;align-items:center;gap:6px;cursor:pointer;user-select:none}
    .switch input{position:absolute;opacity:0;width:0;height:0}
    .slider{ position:relative;width:34px;height:18px;border-radius:999px;background:#e5e7eb;border:1px solid #d1d5db; transition:background .18s }
    [data-theme="dark"] .slider{ background:#0b1422; border-color:#1f2a38 }
    .slider::after{ content:"";position:absolute;top:2px;left:2px;width:14px;height:14px;background:#fff;border-radius:999px;box-shadow:0 2px 6px rgba(0,0,0,.15);transition:left .18s }
    .switch input:checked + .slider{ background:#fde68a; border-color:#f59e0b }
    .switch input:checked + .slider::after{left:18px}

    .cf-note{font-size:10px;color:var(--muted)}
    .pill{display:inline-block;padding:1px 6px;border-radius:999px;border:1px solid var(--line);font-size:10px;color:var(--fg);background:#fff;margin-left:6px}
    [data-theme="dark"] .pill{ background:#0b1422 }

    .table-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
    .table{width:100%;border-collapse:separate;border-spacing:0 4px;margin-top:4px;min-width:520px}
    .table thead th{text-align:left;font-size:10.5px;color:var(--muted);padding:0 6px;white-space:nowrap}
    .table tbody tr{
      background:var(--table-row);border:1px solid var(--line);border-radius:8px;overflow:hidden;box-shadow:0 2px 6px rgba(11,18,32,.06);
      height:50px;
    }
    .table td{padding:0 8px;font-size:12px;color:var(--fg);height:50px;white-space:nowrap;vertical-align:middle}
    .row-actions{display:flex;gap:4px;flex-wrap:nowrap;align-items:center}

    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
    .small{font-size:11px;color:var(--muted)}
    .inpt{height:26px;padding:3px 6px;border:1px solid var(--line);border-radius:7px;font-size:12px;width:100%}
    .sel{height:26px;padding:0 6px;border:1px solid var(--line);border-radius:7px;font-size:12px;background:#fff}
    [data-theme="dark"] .inpt,[data-theme="dark"] .sel{ background:#0b1422; color:#e5eefc }

    .status{ display:grid; gap:6px; grid-template-columns:1fr; }
    .status .items{ display:grid; gap:6px; grid-template-columns:1fr; }
    .pillstat{ display:flex; flex-direction:column; gap:1px; border:1px solid var(--line); background:var(--table-row); border-radius:8px; padding:6px 8px; min-height:38px; justify-content:center }
    .pillstat .k{font-size:10px;color:var(--muted)} .pillstat .v{font-weight:700}

    #serverTime{ color: var(--time) } #yourIp{ color: var(--accent) } #yourLoc{ color: var(--loc) }

    .theme-fab{
      position:fixed; right:12px; bottom:12px; z-index:9999;
      width:40px; height:40px; border-radius:999px; display:inline-flex; align-items:center; justify-content:center;
      background-image:var(--tri); background-size:200% 100%; color:#fff; border:0; box-shadow:0 8px 16px rgba(59,130,246,.3); cursor:pointer;
    }
    .theme-fab svg{ width:18px; height:18px }
    .icon-sun{ display:inline } .icon-moon{ display:none }
    [data-theme="dark"] .icon-sun{ display:none } [data-theme="dark"] .icon-moon{ display:inline }

    /* Login Gate */
    .gate{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:12px; z-index:10000;
      background:
        radial-gradient(1200px 700px at 15% 0%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1300px 800px at 90% 20%, var(--bg2) 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 110%, var(--bg3) 0%, transparent 50%),
        linear-gradient(160deg,#f8fafc 0%, #eff6ff 40%, #f0f9ff 100%) }
    [data-theme="dark"] .gate{ background:
        radial-gradient(1400px 700px at 10% -10%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1400px 800px at 100% 30%, var(--bg2) 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 110%, var(--bg3) 0%, transparent 50%),
        linear-gradient(160deg,#05121a 0%, #0a1826 50%, #0c2036 100%) }
    .gate-card{ width:100%; max-width:340px; border:1px solid var(--line); border-radius:10px; padding:12px; background:var(--card); box-shadow:var(--shadow-strong); backdrop-filter:blur(10px) }
    .gate-title{ display:flex; align-items:center; gap:6px; font-weight:900; font-size:16px; margin-bottom:6px }
    .gate-msg{ margin-top:6px; font-size:11px }

    /* Floating Logout */
    .logout-fab{
      position:fixed; top:12px; right:12px; z-index:10001;
      width:40px; height:40px; border-radius:999px;
      display:inline-flex; align-items:center; justify-content:center;
      background-image:var(--tri); background-size:200% 100%;
      color:#fff; border:0; box-shadow:0 8px 16px rgba(59,130,246,.30);
      cursor:pointer; transition:transform .12s ease, background-position .2s ease;
    }
    .logout-fab:hover{ transform: translateY(-1px); background-position:right center; }
    .logout-fab svg{ width:18px; height:18px }

    .hide{ display:none!important }
  </style>
</head>
<body>
  <!-- LOGIN -->
  <div id="gate" class="gate" aria-modal="true" role="dialog">
    <div class="gate-card">
      <div class="gate-title">
        <span class="logo"><img alt="logo" src="https://raw.githubusercontent.com/saw388/websitesDNS/refs/heads/main/H%20VPN%20Unlimited%20.png"></span>
        <span>PVPN — Login</span>
      </div>
      <div class="small" style="margin-bottom:6px;color:var(--muted)">အောက်ပါအကောင့်ဖြင့် login ပြုလုပ်ပါ။</div>
      <form id="loginForm" autocomplete="off" style="display:grid; gap:6px">
        <div>
          <label for="loginUser" style="font-size:11px;color:var(--muted)">Username</label>
          <input id="loginUser" placeholder="Username" />
        </div>
        <div>
          <label for="loginPass" style="font-size:11px;color:var(--muted)">Password</label>
          <input id="loginPass" type="password" placeholder="••••••" />
        </div>
        <div class="btns" style="margin-top:2px"><button type="submit" style="width:100%">Enter</button></div>
        <div id="loginMsg" class="gate-msg"></div>
      </form>
    </div>
  </div>

  <div class="wrap hide" id="appWrap">
    <!-- STATUS -->
    <div class="card status" aria-live="polite">
      <h2 style="margin-bottom:2px">Status</h2>
      <div class="items">
        <div class="pillstat"><div class="k">Server Time</div><div id="serverTime" class="v mono">—</div></div>
        <div class="pillstat"><div class="k">Your IP</div><div id="yourIp" class="v mono">—</div></div>
        <div class="pillstat"><div class="k">Location</div><div id="yourLoc" class="v">—</div></div>
      </div>
    </div>

    <!-- DNS FORM -->
    <div class="card">
      <h1><span class="logo"><img alt="logo" src="https://play-lh.googleusercontent.com/tUt7o9JtLGGEzSo6kOXdJ8MpYAGhBUYEV2yoIGn4jtVA4WNQPfksB5ze8E29WpcrOdTgMVxuDygxFvtATiWS=w240-h480-rw"></span> PVPN DNS CREATOR</h1>
      <p class="byline">Power By : PPH DEX 2025</p>

      <form id="dnsForm" autocomplete="off">
        <div class="row">
          <label for="type">Type</label>
          <select id="type" required>
            <option value="A">A</option><option value="AAAA">AAAA</option><option value="CAA">CAA</option><option value="CERT">CERT</option>
            <option value="CNAME">CNAME</option><option value="DNSKEY">DNSKEY</option><option value="DS">DS</option><option value="HTTPS">HTTPS</option>
            <option value="LOC">LOC</option><option value="MX">MX</option><option value="NAPTR">NAPTR</option><option value="NS">NS</option>
            <option value="OPENPGPKEY">OPENPGPKEY</option><option value="PTR">PTR</option><option value="SMIMEA">SMIMEA</option><option value="SRV">SRV</option>
            <option value="SSHFP">SSHFP</option><option value="SVCB">SVCB</option><option value="TLSA">TLSA</option><option value="TXT">TXT</option><option value="URI">URI</option>
          </select>
        </div>

        <div class="row">
          <label for="host">Host</label>
          <input id="host" type="text" placeholder="sub (or sub.pphdev.shop)" required />
        </div>

        <div class="row">
          <label id="contentLabel" for="content">IPv4 Address</label>
          <input id="content" type="text" placeholder="e.g. 203.0.113.10" required />
        </div>

        <div class="row" id="prioRow" style="display:none">
          <label for="priority">Priority</label>
          <input id="priority" type="number" min="0" max="65535" placeholder="10 (MX only)" />
        </div>

        <div class="row">
          <label for="ttl">TTL</label>
          <select id="ttl">
            <option value="1" selected>Auto</option>
            <option value="60">60</option><option value="120">120</option><option value="300">300</option>
            <option value="600">600</option><option value="1800">1800</option><option value="3600">3600</option>
          </select>
        </div>

        <div class="row" id="proxiedRow">
          <label for="proxied">Proxy through Cloudflare</label>
          <div>
            <label class="switch" aria-label="Proxy through Cloudflare">
              <input id="proxied" type="checkbox" checked />
              <span class="slider" aria-hidden="true"></span>
            </label>
            <span class="pill">A / AAAA / CNAME only</span>
            <div class="cf-note">DNS ONLY အတွက် ခလုတ်ကို ပိတ်ပေးပါ။</div>
          </div>
        </div>

        <div class="btns">
          <button type="submit">Add / Update</button>
          <button type="button" id="resetBtn">Reset</button>
        </div>
        <div id="msg"></div>

        <div class="small" style="margin-top:4px">
          Host ကို short (e.g. <span class="mono">app</span>) ရိုက်ရင်
          <span class="mono">app.pphdev.shop</span> လို append လုပ်ပေးမယ်။
        </div>
      </form>
    </div>

    <!-- LOOKUP -->
    <div class="card">
      <h2>Host to IP <span class="small">(Lookup)</span></h2>
      <div class="row">
        <label for="lookupHost">Host</label>
        <input id="lookupHost" type="text" placeholder="sub (or full hostname)" />
      </div>
      <div class="btns" style="margin-top:6px">
        <button type="button" id="lookupBtn">Lookup</button>
        <button type="button" id="lookupReset">Clear</button>
      </div>
      <div id="lookupMsg"></div>
    </div>

    <!-- SEARCH/MANAGE -->
    <div class="card">
      <h2>Cloudflare DNS Records (Search / Edit / Delete)</h2>
      <div class="row">
        <label for="cfName">Search</label>
        <input id="cfName" placeholder="Search by name or content (partial match)" />
      </div>
      <div class="row">
        <label for="cfType">Type</label>
        <select id="cfType">
          <option value="">(Any)</option>
          <option>A</option><option>AAAA</option><option>CAA</option><option>CERT</option>
          <option>CNAME</option><option>DNSKEY</option><option>DS</option><option>HTTPS</option>
          <option>LOC</option><option>MX</option><option>NAPTR</option><option>NS</option>
          <option>OPENPGPKEY</option><option>PTR</option><option>SMIMEA</option><option>SRV</option>
          <option>SSHFP</option><option>SVCB</option><option>TLSA</option><option>TXT</option><option>URI</option>
        </select>
      </div>
      <div class="btns">
        <button type="button" id="cfSearch">Search</button>
        <button type="button" id="cfClear">Clear</button>
      </div>
      <div id="searchMsg" class="small">အောက်က results က Cloudflare မှ တိုက်ရိုက် query လုပ်ထားတာပါ။</div>

      <div class="table-wrap">
        <table class="table" aria-label="Cloudflare search results">
          <thead>
            <tr>
              <th>Type</th><th>Name</th><th>Content</th><th>TTL</th><th>Proxy</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="cfBody"></tbody>
        </table>
      </div>

      <div class="btns" style="justify-content:flex-end;margin-top:4px">
        <button class="btn-mini" id="prevPage">Prev</button>
        <button class="btn-mini" id="nextPage">Next</button>
      </div>
    </div>

    <div class="footer">Developer : PPH DEX 2025</div>
  </div>

  <!-- Theme toggle -->
  <button id="themeToggle" class="theme-fab hide" title="Dark/Light Toggle" aria-label="Toggle dark or light theme">
    <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="4"></circle>
      <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/>
    </svg>
    <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <!-- Floating Logout -->
  <button id="logoutFab" class="logout-fab hide" title="Logout" aria-label="Logout">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7"/>
    </svg>
  </button>

  <script>
    const ROOT = "pphdev.shop";
    const API_BASE = "https://pphdevweb.painghein556.workers.dev";
    const API_URL  = API_BASE + "/dns";

    const gate=document.getElementById("gate"),
          appWrap=document.getElementById("appWrap"),
          themeFab=document.getElementById("themeToggle"),
          logoutFab=document.getElementById("logoutFab");

    const loginForm=document.getElementById("loginForm"),
          loginUser=document.getElementById("loginUser"),
          loginPass=document.getElementById("loginPass"),
          loginMsg=document.getElementById("loginMsg");

    // Basic Auth token ကို localStorage မှာ သိမ်းထားမယ်
    function getAuthHeader() {
      const token = localStorage.getItem("pphdex_auth");
      return token ? { "Authorization": `Basic ${token}` } : {};
    }

    function showApp(){
      gate.classList.add("hide");
      appWrap.classList.remove("hide");
      themeFab.classList.remove("hide");
      logoutFab.classList.remove("hide");
      loginUser.value=""; loginPass.value=""; loginMsg.textContent="";
      try{ loadStatus(); runSearch(); }catch(e){}
    }
    function hideApp(){
      gate.classList.remove("hide");
      appWrap.classList.add("hide");
      themeFab.classList.add("hide");
      logoutFab.classList.add("hide");
      setTimeout(()=>loginUser.focus(), 50);
    }

    // Auto login if token exists
    (function initAuth(){
      const token = localStorage.getItem("pphdex_auth");
      if (token) {
        // simple test call to verify token
        fetch(API_URL + "?per_page=1", { headers: getAuthHeader() })
          .then(r => { if (r.ok) showApp(); else hideApp(); })
          .catch(() => hideApp());
      } else {
        hideApp();
      }
    })();

    logoutFab.addEventListener("click", ()=> {
      localStorage.removeItem("pphdex_auth");
      hideApp();
    });

    // Login with Basic Auth
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const u = (loginUser.value || "").trim();
      const p = (loginPass.value || "").trim();

      if (!u || !p) {
        loginMsg.textContent = "Username နဲ့ Password ဖြည့်ပါ";
        return;
      }

      const token = btoa(`${u}:${p}`);
      localStorage.setItem("pphdex_auth", token);

      // Test token
      try {
        const test = await fetch(API_URL + "?per_page=1", { headers: { "Authorization": `Basic ${token}` } });
        if (test.ok) {
          loginMsg.textContent = "Login success ✅";
          showApp();
        } else {
          throw new Error();
        }
      } catch (err) {
        localStorage.removeItem("pphdex_auth");
        loginMsg.textContent = "❌ Username / Password မမှန်ပါ";
      }
    });

    /* ===== Theme ===== */
    (function initTheme(){
      try{
        const root=document.documentElement;
        const saved=localStorage.getItem("theme");
        const prefersDark=window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        root.setAttribute("data-theme", saved || (prefersDark ? "dark" : "light"));
      }catch(e){}
    })();
    themeFab.addEventListener("click", ()=>{
      const root=document.documentElement;
      const cur=root.getAttribute("data-theme")||"light";
      const next=(cur==="light")?"dark":"light";
      root.setAttribute("data-theme", next);
      try{ localStorage.setItem("theme", next); }catch(e){}
    });

    /* ===== Status ===== */
    // (unchanged - မူလအတိုင်း ထားထားပါတယ်)
    const serverTimeEl=document.getElementById("serverTime");
    const yourIpEl=document.getElementById("yourIp");
    const yourLocEl=document.getElementById("yourLoc");

    async function fetchJSON(url,opt){ const r=await fetch(url,opt); if(!r.ok) throw new Error(r.status); return r.json(); }

    async function loadFromCFTrace(){
      try{
        const r=await fetch("https://1.1.1.1/cdn-cgi/trace",{cache:"no-store"});
        const t=await r.text();
        const map=Object.fromEntries(t.trim().split("\n").map(l=>l.split("=")).map(([k,v])=>[k,v]));
        if(map.ts){
          let ms=Number(map.ts)*1000;
          const tzStr=Intl.DateTimeFormat().resolvedOptions().timeZone||"Local";
          const tick=()=>{ serverTimeEl.textContent=new Date(ms).toLocaleString(undefined,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})+` (${tzStr})`; ms+=1000; };
          tick(); setInterval(tick,1000);
        }else{ serverTimeEl.textContent="Unavailable"; }
        if(map.ip) yourIpEl.textContent=map.ip;
        if(!yourLocEl.textContent || yourLocEl.textContent==="—" || yourLocEl.textContent==="Unavailable"){
          yourLocEl.textContent=map.loc || "Unavailable";
        }
      }catch(e){
        if(!serverTimeEl.textContent || serverTimeEl.textContent==="—") serverTimeEl.textContent="Unavailable";
      }
    }
    async function loadStatus(){
      // (original code အတိုင်း ထားထားပါတယ်)
      let haveWT=false;
      try{
        const t=await fetchJSON("https://worldtimeapi.org/api/ip");
        const dt=new Date(t.datetime);
        let base=dt.getTime();
        const tick=()=>{ serverTimeEl.textContent=new Date(base).toLocaleString(undefined,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})+` (${t.timezone})`; base+=1000; };
        tick(); setInterval(tick,1000);
        if(t.client_ip) yourIpEl.textContent=t.client_ip;
        haveWT=true;
      }catch(e){}
      try{
        const a=await fetchJSON("https://ipapi.co/json/");
        if(a.ip) yourIpEl.textContent=a.ip;
        const loc=[a.city,a.region,a.country_name].filter(Boolean).join(", ");
        yourLocEl.textContent=loc || "—";
      }catch(e){
        try{
          const b=await fetchJSON("https://ipwho.is/");
          if(b.ip) yourIpEl.textContent=b.ip;
          const loc=[b.city,b.region,b.country].filter(Boolean).join(", ");
          yourLocEl.textContent=loc || "—";
        }catch(e2){
          try{ const c=await fetchJSON("https://api.ipify.org?format=json"); if(c.ip) yourIpEl.textContent=c.ip; }catch(e3){}
          if(!yourLocEl.textContent || yourLocEl.textContent==="—") yourLocEl.textContent="Unavailable";
        }
      }
      if(!haveWT){ await loadFromCFTrace(); }
    }

    /* ===== Helpers & DNS Form (အားလုံး API call မှာ auth header ထည့်ပေးထားပါတယ်) ===== */
    // ... (ကျန်တဲ့ code တွေကို မူလအတိုင်း ထားပြီး fetch တွေမှာ headers: { ...getAuthHeader() } ထည့်ပေးထားပါတယ်။
    // နေရာရှင်းရင် အပြည့်အစုံ အောက်မှာ ဆက်ထားပါတယ်။

    const typeEl=document.getElementById("type"),
          hostEl=document.getElementById("host"),
          contentEl=document.getElementById("content"),
          contentLabel=document.getElementById("contentLabel"),
          prioRow=document.getElementById("prioRow"),
          priorityEl=document.getElementById("priority"),
          proxiedRow=document.getElementById("proxiedRow"),
          proxiedEl=document.getElementById("proxied"),
          ttlEl=document.getElementById("ttl"),
          msg=document.getElementById("msg");

    // ... (ကျန်တဲ့ script အပြည့်အစုံ အောက်ပါအတိုင်း)

    // ဒီနေရာမှာ ကျန်တဲ့ original script ကို ဆက်ထည့်ပြီး fetch အားလုံးကို headers ထည့်ပေးထားပါတယ်။

    // ဥပမာ createRecordPreferNew, listExistingByNameType, runSearch, saveEdit, delete စသဖြင့် အားလုံးမှာ
    // fetch(..., { headers: { "Content-Type": "application/json", ...getAuthHeader() } })

    // အပြည့်အစုံ code ကို အောက်မှာ ဆက်ရေးထားပါတယ်။

    // (အောက်က အပြည့်အစုံ script ပါ)

    <script>
      // ... (အပေါ်က code အဆုံးထိ ဆက်ထားပါတယ်)

      // အဓိက fetch တွေ အားလုံးမှာ getAuthHeader() ထည့်ထားပါတယ်။

      async function listExistingByNameType(name,type){
        const params=new URLSearchParams({name,type,page:"1",per_page:"200"});
        const r = await fetch(`${API_URL}?${params.toString()}`, { headers: getAuthHeader() });
        const j = await r.json();
        if(j?.success) return j.result||[];
        return [];
      }

      async function createRecordPreferNew(payload){
        try{
          const res=await fetch(API_URL+"?create=1",{method:"POST",headers:{"Content-Type":"application/json", ...getAuthHeader()},body:JSON.stringify(payload)});
          const data=await res.json(); if(data?.success) return data;
        }catch(e){}
        const res2=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json","X-Force-Create":"1", ...getAuthHeader()},body:JSON.stringify(payload)});
        return await res2.json();
      }

      async function runSearch(){
        const params=new URLSearchParams();
        if(cfName.value.trim()) params.set("name", cfName.value.trim());
        if(cfType.value) params.set("type", cfType.value);
        params.set("page", String(page));
        params.set("per_page","50");
        searchMsg.textContent="Searching…"; searchMsg.className="msg-warn";

        try{
          const res=await fetch(`${API_URL}?${params.toString()}`,{method:"GET", headers: getAuthHeader()});
          const data=await res.json();
        }catch(err){
          // ...
        }
      }


    </script>

